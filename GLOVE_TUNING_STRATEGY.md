# GLOVE 参数调优策略

## 当前性能分析 (历史数据)

### 旧版本性能 (M=16, ef_c≈100)
- 构建时间: 27.9 分钟 ✓ (< 30分钟)
- 召回率@10: **83.2%** ❌ (目标 ≥98%)
- 查询速度: 1.47 ms ✓

**问题**: 召回率严重不足,比目标低 14.8%!

## 参数调优方案

### v1.0 参数 (当前)
```cpp
M = 24;                 // +50% connectivity
ef_construction = 200;  // +100% construction quality  
ef_search = 300;        // +50% search range
```

**预期改进**:
- 召回率: 83.2% → **90-95%** (仍可能不足)
- 构建时间: 27.9min → 35-40min (可能超时!)
- 查询速度: 1.47ms → 1.0-1.5ms

**风险**: 构建时间可能超过 30 分钟限制

### v1.1 参数 (推荐 - 平衡版)
```cpp
M = 20;                 // 适中连接度
ef_construction = 180;  // 高质量但不过度
ef_search = 350;        // 更高搜索补偿
```

**理论分析**:
- 构建复杂度: N × M × ef_c = 1.2M × 20 × 180 = 4.32B 操作
- vs v1.0: 1.2M × 24 × 200 = 5.76B 操作 (减少 25%)
- 预期构建时间: ~28-32 分钟 (边界附近)
- 预期召回率: 92-96% (更高 ef_search 补偿)

### v1.2 参数 (激进 - 高召回版)
```cpp
M = 24;
ef_construction = 250;
ef_search = 400;
```

**仅在 v1.0/v1.1 召回率不足时使用**
- 预期召回率: 96-99%
- 构建时间: 40-45 分钟 (超时风险!)

### v1.3 参数 (保守 - 快速版)
```cpp
M = 18;
ef_construction = 150;
ef_search = 400;
```

**如果 v1.0 构建超时,降级使用**
- 预期构建时间: ~22-25 分钟
- 预期召回率: 88-93% (可能仍不足)

## 调优流程

### 第一轮: v1.0 测试
当前运行中,等待结果:
- 如果召回率 ≥ 98%: ✓ 完成
- 如果构建时间 > 30min: → 使用 v1.1 或 v1.3
- 如果召回率 90-97%: → 增加 ef_search (v1.0+)
- 如果召回率 < 90%: → 使用 v1.2 (激进版)

### 第二轮: 根据结果调整

#### 情况 A: 召回率不足 (< 98%)
```cpp
// 仅增加 ef_search (不影响构建时间)
ef_search: 300 → 350 → 400 → 500
```

#### 情况 B: 构建超时 (> 30min)
```cpp
// 降低构建参数
M: 24 → 20 → 18
ef_construction: 200 → 180 → 150
// 提高搜索补偿
ef_search: 300 → 400
```

#### 情况 C: 同时超时+召回不足
```cpp
// 使用 v1.1 平衡参数
M = 20
ef_construction = 180
ef_search = 400
```

## 参数网格搜索 (如需精确调优)

### 构建参数组合 (控制构建时间)
| 组合 | M | ef_construction | 预估时间 | 优先级 |
|------|---|-----------------|----------|--------|
| Fast | 16 | 150 | ~20min | 备用 |
| Balanced | 20 | 180 | ~28min | **推荐** |
| Quality | 24 | 200 | ~33min | 当前 |
| Premium | 24 | 250 | ~40min | 风险 |

### 搜索参数调整 (不影响构建时间)
| ef_search | 预估召回 | 预估速度 | 预估距离计算 |
|-----------|----------|----------|--------------|
| 200 | 85-90% | 1.0ms | ~15,000 |
| 300 | 90-95% | 1.3ms | ~20,000 |
| 350 | 93-96% | 1.5ms | ~23,000 |
| 400 | 95-97% | 1.7ms | ~26,000 |
| 500 | 97-99% | 2.0ms | ~32,000 |

## 目标达成矩阵

### 必须满足 (硬约束)
- [x] 构建时间 < 30 分钟
- [ ] 召回率 ≥ 98%

### 优化目标 (软约束)  
- [ ] 距离计算 ~20,042 次 (98%召回参考)
- [ ] 查询速度 < 2ms

## 决策树

```
开始
 │
 ├─ v1.0 结果?
 │   ├─ 召回率 ≥ 98% AND 时间 < 30min → ✓ 完成!
 │   ├─ 召回率 < 98% AND 时间 < 30min → 增加 ef_search
 │   ├─ 召回率 ≥ 98% AND 时间 > 30min → 不可能,降低参数
 │   └─ 召回率 < 98% AND 时间 > 30min → 使用 v1.1 平衡版
 │
 ├─ v1.1 结果?
 │   ├─ 召回率 ≥ 98% → ✓ 完成!
 │   └─ 召回率 < 98% → 增加 ef_search 到 400-500
 │
 └─ 最终调整
     └─ 逐步增加 ef_search 直到达标
```

## 当前行动

1. ⏳ 等待 v1.0 (M=24, ef_c=200, ef_s=300) 测试结果
2. 📊 预期等待时间: ~35-40 分钟
3. 🎯 关键指标: 召回率和构建时间
4. 📝 根据结果执行上述决策树

---

**更新时间**: 2025-11-26 13:50
**状态**: v1.0 测试运行中
